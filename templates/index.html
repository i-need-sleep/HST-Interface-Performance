{% extends 'base.html'%}

{% block head %}

<!-- Magenta -->
<script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.5.0"></script>

<!-- HTML MIDI Player -->
<script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.21.0/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.1.0"></script>


<!-- D3 -->
<script src="https://d3js.org/d3.v6.min.js"></script>

<title> Index </title>
{% endblock %}

{% block body %}

    <!-- Nav Bar -->
<nav class="navbar navbar-expand-sm bg-light">
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <button id='resample' class="btn" value="{{next_sample}}">New Sample</button><br> 
      </li>
  </ul>
  <ul class="navbar-nav">
      <li class="nav-item">
        <a tabindex="0" class="btn" role="button" data-toggle="popover" data-trigger="focus" title="Help" 
        data-content="Keyboard shortcuts: <br> 
        <ul>
          <li>1-7: select chord</li>
          <li>space: play/pause</li>
          <li>backspace / q: back</li>
          <li>r: reset</li>
        </ul>"  data-html="true">
          Help
        </a><br>
      </li>
  </ul>
  </div>
</nav>


<div class="container pt-3 pb-5" id="app">
  <!-- Original -->
  <!-- Time steps: Original -->
  <table id=time_steps class="table table-fixed prog_table">
    <thead class="thead-light">
    <tr>
        <th class = "prog_head table_cell"></th>
        {% for i in range(1,17) %}
        <th class= "time_cell" id="time{{i}}"> {{1+(i-1)//4}}.{{(i-1)%4+1}} </th>
        {% endfor %}
        <th></th><th></th>
    </tr>
    </thead>
  </table> 

    <midi-visualizer src="{{original_midi_path}}" type="piano-roll" id="original_vis"></midi-visualizer>
    <svg class="original_svg svg" height="0px"></svg>

  <div class="up">

  <!-- Original Progression -->
  <table id="original_prog" class="table table-fixed table-striped prog_table">
    <tbody>
    <tr>
        <th id=play_prog_original class="prog_head">Original</th>
        {% for i in range(0,16) %}
        <th id="original_prog{{i}}" class="table_cell" style="font-weight:normal;"> {{ original_chord_str[i] }} </td>
        {% endfor %}
        <th></th><th></th>
    </tr>
    </tbody>  
  </table>

  <!-- Altered -->
  <!-- Time steps -->
  <table id=altered_time_steps class="table table-fixed prog_table">
    <thead class="thead-light">
    <tr>
        <th class = "prog_head table_cell"></th>
        {% for i in range(1,17) %}
        <th class= "time_cell" id="time_altered{{i}}"> {{1+(i-1)//4}}.{{(i-1)%4+1}} </th>
        {% endfor %}
        <th></th><th></th>
    </tr>
    </thead>
  </table> 

  <canvas id="altered_canvas"></canvas>
  <svg class="swapped_svg svg" id="swapped_svg" height="0px"></svg>
  
  <div class="up">
  <!-- Altered Progression -->
  <table id=saved_prog class="table table-fixed table-striped prog_table">
    <tbody>
      <tr>
        <th id=play_prog_original class="prog_head">Altered</th>
        {% for i in range(0,16) %}
        <th id="altered{{i}}" class="table_cell" style="font-weight:normal;"></td>
        {% endfor %}
        <th></th>
    </tr>
    </tbody>
  </table> 

    <div class="row">
    <div class="col-4">
    <button id="altered_play" class="btn btn-light">Loading</button>
    <button id="altered_back" class="btn btn-light">back</button>
    <button id="altered_reset" class="btn btn-light">Reset</button><br>
    Bpm: <span id=bpm_text>60</span><div id=slider_container><input type="range" class="form-control-range" id=bpm_slider min=30 max=200 value=60></div>
    <div class="input-group-prepend">
    <div class="input-group-text" style="width:160px">
      <input type="checkbox" id="root_overlay" checked>  &nbsp Root overlay
    </div>
    </div>
    <div class="input-group-prepend">
      <div class="input-group-text" style="width:160px">
        <input type="checkbox" id="chord_overlay" >  &nbsp Chord overlay
      </div>
    </div>
  </div>

  <div class="col-3">
  <svg id="dial_svg"></svg>
  </div>
</div>
</div>
</div>
</div>

<!-- Barlines -->
<svg id=original_barline class="barline_svg"></svg><br>
<svg id=altered_barline class="barline_svg"></svg>

<midi-player src="{{original_midi_path}}" sound-font visualizer="#original_vis" id="original_player"></midi-player>

<script type="application/javascript"> 
  var notedic = {{notedic | tojson | safe}}
  var original_chd = JSON.parse('{{chd_mat|tojson}}')
</script>
<script type="application/javascript" src="{{url_for('static', filename='main.js')}}"></script>
    
{% endblock %}